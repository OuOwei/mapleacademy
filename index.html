<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自由團-工具</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .completed-times-section { background-color: #e6f3ff; }
        .extra-settings-section { background-color: #e6ffe6; }
        .result-section { background-color: #ffe6e6; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">自由團 - 楓之谷怪物公園勳章計算器</h1>
        <form id="medalCalculator">
            <div class="row mb-3">
                <div class="col-md-6 p-3 completed-times-section">
                    <h3>已完成次數</h3>
                    <div class="mb-2">
                        <label for="monday" class="form-label">星期一</label>
                        <input type="number" class="form-control completed-times" id="monday" min="0" max="77" value="0">
                    </div>
                    <div class="mb-2">
                        <label for="tuesday" class="form-label">星期二</label>
                        <input type="number" class="form-control completed-times" id="tuesday" min="0" max="77" value="0">
                    </div>
                    <div class="mb-2">
                        <label for="wednesday" class="form-label">星期三</label>
                        <input type="number" class="form-control completed-times" id="wednesday" min="0" max="77" value="0">
                    </div>
                    <div class="mb-2">
                        <label for="thursday" class="form-label">星期四</label>
                        <input type="number" class="form-control completed-times" id="thursday" min="0" max="77" value="0">
                    </div>
                    <div class="mb-2">
                        <label for="friday" class="form-label">星期五</label>
                        <input type="number" class="form-control completed-times" id="friday" min="0" max="77" value="0">
                    </div>
                    <div class="mb-2">
                        <label for="saturday" class="form-label">星期六</label>
                        <input type="number" class="form-control completed-times" id="saturday" min="0" max="77" value="0">
                    </div>
                    <div class="mb-2">
                        <label for="sunday" class="form-label">星期日</label>
                        <input type="number" class="form-control completed-times" id="sunday" min="0" max="77" value="0">
                    </div>
                </div>
                <div class="col-md-6 p-3 extra-settings-section">
                    <h3>額外設定</h3>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="useExtraTimes">
                        <label class="form-check-label" for="useExtraTimes">使用每天多打次數</label>
                    </div>
                    <div class="mb-3">
                        <label for="extraTimes" class="form-label">每天多打次數</label>
                        <select class="form-select" id="extraTimes" disabled>
                            <option value="0" selected>0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="useTargetDate">
                        <label class="form-check-label" for="useTargetDate">使用希望完成日期</label>
                    </div>
                    <div class="mb-3">
                        <label for="targetDate" class="form-label">希望完成日期</label>
                        <input type="date" class="form-control" id="targetDate" disabled>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg btn-block w-100 mb-3">計算</button>
        </form>
        <div class="row">
            <div class="col-md-12 p-3 result-section">
                <h3>計算結果</h3>
                <div id="result"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const useExtraTimesCheckbox = document.getElementById('useExtraTimes');
        const extraTimesSelect = document.getElementById('extraTimes');
        const useTargetDateCheckbox = document.getElementById('useTargetDate');
        const targetDateInput = document.getElementById('targetDate');

        useExtraTimesCheckbox.addEventListener('change', function() {
            extraTimesSelect.disabled = !this.checked;
            if (this.checked) {
                useTargetDateCheckbox.checked = false;
                targetDateInput.disabled = true;
            }
        });

        useTargetDateCheckbox.addEventListener('change', function() {
            targetDateInput.disabled = !this.checked;
            if (this.checked) {
                useExtraTimesCheckbox.checked = false;
                extraTimesSelect.disabled = true;
            }
        });

        document.getElementById('medalCalculator').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const completedTimes = Array.from(document.querySelectorAll('.completed-times')).map(input => parseInt(input.value));
            const useExtraTimes = useExtraTimesCheckbox.checked;
            const extraTimes = useExtraTimes ? parseInt(extraTimesSelect.value) : 0;
            const useTargetDate = useTargetDateCheckbox.checked;
            const targetDate = useTargetDate ? new Date(targetDateInput.value) : null;
            const today = new Date();

            const totalCompleted = completedTimes.reduce((a, b) => a + b, 0);
            const remainingTimes = 7 * 77 - totalCompleted;
            const freePlaysPerDay = 2;
            const maxPlaysPerDay = 7;
            const totalPlaysPerDay = Math.min(freePlaysPerDay + extraTimes, maxPlaysPerDay);

            let resultHtml = `<p>剩餘完成次數：${remainingTimes}</p>`;

            if (useTargetDate && targetDate) {
                const daysUntilTarget = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
                const requiredPlaysPerDay = Math.ceil(remainingTimes / daysUntilTarget);
                const requiredPaidPlaysPerDay = Math.min(Math.max(0, requiredPlaysPerDay - freePlaysPerDay), 5);
                const actualPlaysPerDay = Math.min(requiredPlaysPerDay, maxPlaysPerDay);
                const actualDaysNeeded = Math.ceil(remainingTimes / actualPlaysPerDay);
                const actualCompletionDate = new Date(today.getTime() + actualDaysNeeded * 24 * 60 * 60 * 1000);
                const totalCost = actualDaysNeeded * requiredPaidPlaysPerDay * 10;

                resultHtml += `
                    <p>距離目標日期天數：${daysUntilTarget}</p>
                    <p>每天需完成次數/任務每天總次數上限：${actualPlaysPerDay}/${maxPlaysPerDay}</p>
                    <p>每天需要額外付費次數：${requiredPaidPlaysPerDay}</p>
                    <p>實際完成日期：${actualCompletionDate.toLocaleDateString()}</p>
                    <p>預計總金額：${totalCost} 元</p>
                `;

                if (requiredPlaysPerDay > maxPlaysPerDay) {
                    resultHtml += '<div class="alert alert-warning">警告：每天需要完成的次數超過7次。實際完成日期將晚於目標日期。</div>';
                }
            } else {
                const daysNeeded = Math.ceil(remainingTimes / totalPlaysPerDay);
                const estimatedCompletionDate = new Date(today.getTime() + daysNeeded * 24 * 60 * 60 * 1000);
                
                resultHtml += `
                    <p>預計天數：${daysNeeded} 天</p>
                    <p>預計完成日期：${estimatedCompletionDate.toLocaleDateString()}</p>
                    <p>每天需完成次數/任務每天總次數上限：${totalPlaysPerDay}/${maxPlaysPerDay}</p>
                `;

                if (useExtraTimes) {
                    const totalCost = daysNeeded * extraTimes * 10;
                    resultHtml += `<p>預計總金額：${totalCost} 元</p>`;
                }
            }

            document.getElementById('result').innerHTML = resultHtml;
        });
    </script>
</body>
</html>